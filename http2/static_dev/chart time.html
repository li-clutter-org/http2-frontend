<!DOCTYPE html>
<meta charset="utf-8">
<style>
.http2_sending {
  fill: #666ac2;
}
.http2_waiting{
	fill: #bec1fc;
}
.http2_receiving{
	fill: #666ac2;
}

.http1_sending {
  fill: #69b628;
}
.http1_waiting{
	fill: #9dde67;
}
.http1_receiving{
	fill: #69b628;
}

.chart text {
  fill: black;
  font: 10px sans-serif;
  text-anchor: end;
}
.chart .url {
    fill: white;
}
text.footer{
    font: 14px sans-serif;
    font-weight: bold;
}
</style>
<svg class="chart"></svg>
<script src="http://d3js.org/d3.v3.min.js"></script>
<script>

/*
The JSON should have the structure:
   [
	{
		http1: [moment the request starts, sending, waiting, receiving, Total elapsed time of the request],
		http2: [moment the request starts, sending, waiting, receiving, Total elapsed time of the request]
	},
	...
   ]
*/	
var data = {
    domain:'https :// www.zunzun.se',
    times:[
	{
    path:'/main.css',
	http1: [0,1,6,7,14], 
	http2: [0,1,3,5,9]
	}, 
	{
    path:'/styles.css',
	http1: [3,4,8,9,21],
	http2: [5,4,5,6,15]
	}, 
	{
    path:'/scripts',
	http1: [2,3,6,7,16], 
	http2: [1,3,5,9,17]
	},
	{
    path:'/routings.js',
	http1: [6,1,1,2,4], 
	http2: [7,2,1,1,4]
	}
    ]
};


var width = 620,
    barHeight = 80,
    serie_height = barHeight*0.12,
    http1_y = barHeight*0.33,
    http2_y = barHeight*0.55,
    left=20, <!-- percent respect width-->
    vertial_separator = left*width/100,
    total_width = width+vertial_separator,
    footer_height = 30;
    

var x = d3.scale.linear()
    .domain([0, d3.max(data.times, function(d) {
		return Math.max(
			d.http1[4]+d.http1[0],
			d.http2[4]+d.http1[0]); 
		}
		)])
    .range([0, width]);

var chart = d3.select(".chart")
    .attr("width", vertial_separator + width)
    .attr("height", barHeight * data.times.length + footer_height);

var serie = chart.selectAll("g")
    .data(data.times)
    .enter().append("g")
    .attr("transform", function(d, i) { 
		return "translate(" + vertial_separator + "," + i * barHeight + ")";
		}
	);
<!-- HTTP 1 Serie -->	
serie.append("rect")
	.attr("class","http1_sending")
	.attr("x",function(d) { return x(d.http1[0]); })
	.attr("y",http1_y)
    .attr("width", function(d) { return x(d.http1[1]); })
    .attr("height", serie_height);
    
serie.append("rect")
	.attr("class","http1_waiting")
	.attr("x",function(d) { return x(d.http1[0]) + x(d.http1[1]); })
	.attr("y",http1_y)
    .attr("width", function(d) { return x(d.http1[2]); })
    .attr("height", serie_height);

serie.append("rect")
	.attr("class","http1_receiving")
	.attr("x",function(d) { return x(d.http1[0]) + x(d.http1[1]) + x(d.http1[2]) })
	.attr("y",http1_y)
    .attr("width", function(d) { return x(d.http1[3]); })
    .attr("height", serie_height);
    
 <!-- HTTP 2 Serie -->	
serie.append("rect")
	.attr("class","http2_sending")
	.attr("x",function(d) { return x(d.http2[0]); })
	.attr("y",http2_y)
    .attr("width", function(d) { return x(d.http2[1]); })
    .attr("height", serie_height);
    
serie.append("rect")
	.attr("class","http2_waiting")
	.attr("x",function(d) { return x(d.http2[0]) + x(d.http2[1]); })
	.attr("y",http2_y)
    .attr("width", function(d) { return x(d.http2[2]); })
    .attr("height", serie_height);

serie.append("rect")
	.attr("class","http2_receiving")
	.attr("x",function(d) { return x(d.http2[0]) + x(d.http2[1]) + x(d.http2[2]) })
	.attr("y",http2_y)
    .attr("width", function(d) { return x(d.http2[3]); })
    .attr("height", serie_height)

 <!--  URLs - paths -->
var url = chart.selectAll("div")
    .data(data.times)
    .enter().append("g")
    .attr("transform", function(d, i) {
		return "translate(0," + i * barHeight + ")";
		}
	);
url.append("rect")
	.attr("class","url")
	.attr("x",0)
	.attr("y",0)
    .attr("width", vertial_separator)
    .attr("height", barHeight);

url.append("text")
    .attr("x", vertial_separator-20)
    .attr("y", http2_y-1)
    .text( function(d) { return d.path; });

<!--  Lines -->
chart.selectAll("p")
    .data(data.times).enter()
    .append("line")
    .style("stroke", "black")
    .style("stroke-width", 0.2)
    .attr("x1", 0)
    .attr("y1", function(d, i) {return (i+1) * barHeight;})
    .attr("x2", total_width)
    .attr("y2", function(d, i) {return (i+1) * barHeight;});
chart.append("line")
    .style("stroke", "black")
    .style("stroke-width", 1)
    .attr("x1", vertial_separator-1)
    .attr("y1", 0)
    .attr("x2", vertial_separator-1)
    .attr("y2", barHeight * data.times.length);

<!--  Footer -->
chart.append("text")
    .attr("class", "footer")
    .attr("x", total_width/2+total_width*0.15)
    .attr("y", barHeight * data.times.length + 20)
    .text( data.domain );
</script>
